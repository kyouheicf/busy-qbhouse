<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>QBãƒã‚¦ã‚¹xxxåº—ã®å¾…ã¡äººæ•°æ¨ç§»</title>
    <!-- Google Chartsã®ãƒ­ãƒ¼ãƒ‰ -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var selectedDate = document.getElementById("dateDropdown").value;
            // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã‚’ä½¿ç”¨ã—ã¦å‡¦ç†ã‚’è¡Œã†
            console.log("é¸æŠã•ã‚ŒãŸæ—¥ä»˜: " + selectedDate);
            // ã“ã“ã«é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã«å¯¾ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 

            // AJAXãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            $.ajax({
                url: `https://busy-qbhouse.khayama.workers.dev?date=${selectedDate}`,
                method: 'GET',
                dataType: 'json',
                success: function (json) {
                    const array = json.map(elm => {
                        return [[parseInt(elm.hour), parseInt(elm.min), parseInt("00")], parseInt(elm.num)]
                    })
                    //console.log(`array === ${array}`)
                    var data = new google.visualization.DataTable();
                    data.addColumn('timeofday', 'æ™‚é–“');
                    data.addColumn('number', 'å¾…ã¡äººæ•°');
                    data.addRows(array);

                    var options = {
                        title: 'QBãƒã‚¦ã‚¹xxxåº—ã®å¾…ã¡äººæ•°æ¨ç§»',
                        width: 800,
                        height: 400,
                        hAxis: {
                            title: 'æ™‚é–“',
                            format: 'HH:mm', // 24æ™‚é–“è¡¨è¨˜
                            viewWindow: {
                                min: [9, 0, 0], // æ¨ªè»¸ã®æœ€å°å€¤ (09:00)
                                max: [20, 0, 0] // æ¨ªè»¸ã®æœ€å¤§å€¤ (20:00)
                            },
                        },
                        vAxis: {
                            title: 'å¾…ã¡äººæ•°',
                            minValue: 0, // ç¸¦è»¸ã®æœ€å°å€¤
                            maxValue: 10 // ç¸¦è»¸ã®æœ€å¤§å€¤
                        },
                        colors: ['blue'], // ç·šã®è‰² (æ´’è½ãŸæ„Ÿã˜ã«èª¿æ•´å¯èƒ½)
                        legend: 'none'
                    };

                    var chart = new google.visualization.LineChart(document.getElementById('lineChart'));

                    chart.draw(data, options);
                },
                error: function (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                }
            });
        }
        function padTwoDigits(num) {
            return num.toString().padStart(2, "0");
        }

        function dateInYyyyMmDdHhMmSs(date, dateDiveder = "-") {
            // :::: Exmple Usage ::::
            // The function takes a Date object as a parameter and formats the date as YYYY-MM-DD hh:mm:ss.
            // ğŸ‘‡ï¸ 2023-04-11 16:21:23 (yyyy-mm-dd hh:mm:ss)
            //console.log(dateInYyyyMmDdHhMmSs(new Date()));

            //  ğŸ‘‡ï¸ï¸ 2025-05-04 05:24:07 (yyyy-mm-dd hh:mm:ss)
            // console.log(dateInYyyyMmDdHhMmSs(new Date('May 04, 2025 05:24:07')));
            // Date divider
            // ğŸ‘‡ï¸ 01/04/2023 10:20:07 (MM/DD/YYYY hh:mm:ss)
            // console.log(dateInYyyyMmDdHhMmSs(new Date(), "/"));
            return (
                [
                    date.getFullYear(),
                    padTwoDigits(date.getMonth() + 1),
                    padTwoDigits(date.getDate()),
                ].join(dateDiveder) +
                " " +
                [
                    padTwoDigits(date.getHours()),
                    padTwoDigits(date.getMinutes()),
                    '00',
                ].join(":")
            );
        }
        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã«æ—¥ä»˜ã‚’å‹•çš„ã«è¿½åŠ ã™ã‚‹é–¢æ•°
        function populateDateDropdown() {
            var dropdown = document.getElementById("dateDropdown");
            var currentDate = new Date(Date.now() + ((new Date().getTimezoneOffset() + (9 * 60)) * 60 * 1000));

            for (var i = 0; i < 14; i++) {
                var date = new Date(currentDate);;
                console.log(`JST Date === ${dateInYyyyMmDdHhMmSs(currentDate)}`)
                date.setDate(currentDate.getDate() - i);
                var formattedDate = dateInYyyyMmDdHhMmSs(date).slice(0, 10); // YYYY-MM-DD å½¢å¼ã«å¤‰æ›
                var option = document.createElement("option");
                option.value = formattedDate;
                option.textContent = formattedDate;
                dropdown.appendChild(option);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
        window.onload = function () {
            populateDateDropdown();
        };
    </script>
</head>

<body>
    <div style="text-align: center;">
        <h1>QBãƒã‚¦ã‚¹xxxåº—ã®å¾…ã¡äººæ•°æ¨ç§»</h1>
    </div>
    <div style="text-align: center;">
        <h4>æ—¥ä»˜ã‚’é¸æŠ</h4>
        <select id="dateDropdown" onchange="drawChart()"></select>
    </div>
    <div style="width: 700px; margin: 0 auto;">
        <div id="lineChart"></div>
    </div>
</body>

</html>